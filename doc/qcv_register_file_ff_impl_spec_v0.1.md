# `qcv_register_file_ff.v` 実装仕様書 (Verilog版) - v0.1

## 1. 役割

RISC-Vの汎用レジスタ (x0-x31) を保持するフリップフロップベースのレジスタファイル。2つの非同期読み出しポートと1つの同期書き込みポートを持つ。

## 2. ポート (v0.1 スコープ)

| 信号名         | 方向   | 幅 | 説明                                       | 接続先 (主な)    |
| :------------- | :----- | :- | :----------------------------------------- | :--------------- |
| `clk_i`        | Input  | 1  | クロック信号                               |                  |
| `rst_ni`       | Input  | 1  | 非同期リセット信号 (Active Low)            |                  |
| `raddr_a_i`    | Input  | 5  | 読み出しポートAのアドレス (rs1)            | `qcv_id_stage`  |
| `rdata_a_o`    | Output | 32 | 読み出しポートAのデータ                    | `qcv_id_stage`  |
| `raddr_b_i`    | Input  | 5  | 読み出しポートBのアドレス (rs2)            | `qcv_id_stage`  |
| `rdata_b_o`    | Output | 32 | 読み出しポートBのデータ                    | `qcv_id_stage`  |
| `waddr_a_i`    | Input  | 5  | 書き込みポートAのアドレス (rd)             | `qcv_wb`        |
| `wdata_a_i`    | Input  | 32 | 書き込みポートAのデータ                    | `qcv_wb`        |
| `we_a_i`       | Input  | 1  | 書き込みポートAのイネーブル                | `qcv_wb`        |

*(注: `RV32E` パラメータ、`test_en_i` ポートはv0.1スコープ外)*

## 3. 内部主要ロジック

*   **レジスタ配列 (`rf_reg_q[31:1]`):**
    *   31個の32ビット幅レジスタをフリップフロップで実装。インデックス1から31に対応。
    *   `always_ff @(posedge clk_i or negedge rst_ni)` ブロックを使用。
    *   リセット時 (`rst_ni` がLow) に全レジスタをゼロクリア。
    *   クロックエッジで、対応する書き込みイネーブル (`we_a_dec[i]`) がHighの場合に `wdata_a_i` で更新。
*   **書き込みアドレスデコーダ (`we_a_dec[31:1]`):**
    *   `waddr_a_i` と `we_a_i` から、各レジスタ (1-31) への書き込みイネーブル信号を生成する組み合わせロジック。
    *   `waddr_a_i` が0の場合はどの `we_a_dec` もアサートされない。
*   **読み出しロジック:**
    *   `raddr_a_i` が0の場合は `32'b0` を出力。0以外の場合は `rf_reg_q[raddr_a_i]` を `rdata_a_o` に出力する組み合わせロジック。
    *   `raddr_b_i` が0の場合は `32'b0` を出力。0以外の場合は `rf_reg_q[raddr_b_i]` を `rdata_b_o` に出力する組み合わせロジック。

## 4. 簡略化 (v0.1)

*   `RV32E` パラメータは `0` (32レジスタ) 固定として実装。
*   `test_en_i` ポートは無視する。

---
(以降、`qcv_cs_registers.v` ... の実装仕様を順次追加していく)
